<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {%- seo -%}
  <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
  <link rel="stylesheet" href="{{ "/assets/css/custom.css" | relative_url }}">
  <link rel="stylesheet" href="{{ "/assets/css/giscus-theme.css" | relative_url }}">
  {%- feed_meta -%}

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”§</text></svg>">

  <!-- Monospace fonts for code-like aesthetic -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400;1,500&family=Fira+Code:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  {%- if jekyll.environment == 'production' and site.google_analytics -%}
  {%- include google-analytics.html -%}
  {%- endif -%}

  <!-- Highlight.js for syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
  <!-- Common languages for the blog -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/sql.min.js"></script>

  <!-- Mermaid.js for diagrams -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark'
    });

    document.querySelectorAll('pre > code.language-mermaid').forEach((codeBlock) => {
      let content = codeBlock.textContent.trim();

      // Force left-to-right orientation
      if (content.startsWith('graph TD') || content.startsWith('graph TB')) {
        content = content.replace(/^graph (TD|TB)/, 'graph LR');
      }

      codeBlock.parentElement.outerHTML = `<div class="mermaid">${content}</div>`;
    });
  </script>

  <!-- Prism.js removed - using Highlight.js instead -->

  <!-- Initialize syntax highlighting and diagrams -->
  <script src="{{ "/assets/js/syntax-and-diagrams.js" | relative_url }}" defer></script>

  <!-- MathJax Support -->
  {%- include mathjax.html -%}

  <!-- Content Security Policy for MathJax, Prism.js, and Giscus -->
  {% if jekyll.environment == 'production' %}
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com https://fonts.gstatic.com https://giscus.app; 
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://giscus.app;
                 font-src 'self' https://fonts.gstatic.com;
                 connect-src 'self' https://cdn.jsdelivr.net https://giscus.app;
                 frame-src https://giscus.app;">
  {% else %}
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com https://fonts.gstatic.com https://giscus.app; 
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://giscus.app;
                 font-src 'self' https://fonts.gstatic.com;
                 connect-src 'self' https://cdn.jsdelivr.net https://giscus.app ws://127.0.0.1:35729 ws://localhost:35729 http://127.0.0.1:35729 http://localhost:35729;
                 frame-src https://giscus.app;">
  {% endif %}

  <!-- Feature Policy to handle Giscus clipboard access -->
  <meta http-equiv="Permissions-Policy" content="clipboard-write=*, clipboard-read=*">

  <!-- Additional meta tags for third-party integration -->
  <meta name="referrer" content="strict-origin-when-cross-origin">

</head>